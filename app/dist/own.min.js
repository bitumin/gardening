function disableForm(t){t.find(":input").prop("disabled",!0)}function enableForm(t){t.find(":input").prop("disabled",!1)}function reportInfo(t,e){toastr.success(t),app.l("Info > "+t+" ("+JSON.stringify(e)+")")}function reportSuccess(t,e){toastr.success(t),app.l("Success > "+t+" ("+JSON.stringify(e)+")")}function reportError(t,e){toastr.error(t),app.l("Error > "+t+" ("+JSON.stringify(e)+")")}function resetModals(){app.s.addPlantModal.modal("hide"),app.s.addPlantForm[0].reset(),enableForm(app.s.addPlantForm),app.s.editPlantModal.modal("hide"),app.s.editPlantForm[0].reset(),enableForm(app.s.editPlantForm),app.s.delPlantModal.modal("hide"),app.s.delPlantForm[0].reset(),enableForm(app.s.delPlantForm),app.s.addChildModal.modal("hide"),app.s.addChildForm[0].reset(),enableForm(app.s.addChildForm),app.s.editChildModal.modal("hide"),app.s.editChildForm[0].reset(),enableForm(app.s.editChildForm),app.s.delChildModal.modal("hide"),app.s.delChildForm[0].reset(),enableForm(app.s.delChildForm)}app.start=(new Date).getTime(),app.execTime=function(){return(new Date).getTime()-app.start},app.log=app.l=function(t,e){"undefined"==typeof e&&(e="Notice"),"dev"===app.c.env&&console.log(app.config.appName+" ["+e+"]: "+t)},app=app||{},app.config=app.c={appName:"Gardening Tools",env:"dev",inAnimation:"fadeIn",outAnimation:"fadeOut",seeders:{genetics:50,plants:25,childrenPerPlant:10,childIsOutProbability:.8}},"dev"===app.config.env&&app.l("Developer mode is ON","Warning"),app.l("App config set"),app.selector=app.s={app:$("#app"),leftMenu:$("#left-menu"),leftMenuItemsList:$("#left-menu-items-list"),content:$("#content"),btnOpenAddPlantModal:$("#btn-open-add-plant-modal"),btnOpenEditPlantModal:$(".btn-open-edit-plant-modal"),btnOpenDeletePlantModal:$(".btn-open-delete-plant-modal"),btnLoadPlantView:$(".btn-load-plant-view"),contentWelcome:$("#content-welcome"),contentPlant:$("#content-plant"),contentChild:$("#content-child"),contentPlantTitleName:$("#content-plant-title-name"),contentPlantTitleGenetics:$("#content-plant-title-genetic"),contentPlantTitleOrigin:$("#content-plant-title-origin"),plantChildrenTab:$("#plant-children"),plantStatsTab:$("#plant-stats"),addPlantModal:$("#add-plant-modal"),addPlantForm:$("#add-plant-form"),addPlantGenetics:$("#add-plant-genetics"),editPlantModal:$("#edit-plant-modal"),editPlantForm:$("#edit-plant-form"),editPlantTitle:$("#edit-plant-title"),editPlantId:$("#edit-plant-id"),editPlantName:$("#edit-plant-name"),editPlantNumber:$("#edit-plant-number"),editPlantGenetics:$("#edit-plant-genetics"),editPlantOrigin:$("#edit-plant-origin"),delPlantModal:$("#delete-plant-modal"),delPlantForm:$("#delete-plant-form"),delPlantId:$("#delete-plant-id"),btnOpenAddChildModal:$(".btn-open-add-child-modal"),btnOpenEditChildModal:$(".btn-open-edit-child-modal"),btnOpenDeleteChildModal:$(".btn-open-delete-child-modal"),plantChildrenTable:$("#plant-children-table"),plantChildrenTableInDateFilter:$("#plant-child-in-date-filter"),plantChildrenTableOutDateFilter:$("#plant-child-out-date-filter"),plantChildrenTableInHeightFilter:$("#plant-child-in-height-filter"),plantChildrenTableOutHeightFilter:$("#plant-child-out-height-filter"),plantChildrenTableInQualityFilter:$("#plant-child-in-quality-filter"),plantChildrenTableOutQualityFilter:$("#plant-child-out-quality-filter"),plantChildrenTableRoomFilter:$("#plant-child-room-filter"),plantChildrenTableProductionFilter:$("#plant-child-production-filter"),addChildModal:$("#add-child-modal"),addChildForm:$("#add-child-form"),addChildInDate:$("#add-child-in-date"),addChildOutDate:$("#add-child-out-date"),editChildModal:$("#edit-child-modal"),editChildForm:$("#edit-child-form"),editChildTitle:$("#edit-child-title"),editChildUuid:$("#edit-child-uuid"),editChildInDate:$("#edit-child-in-date"),editChildOutDate:$("#edit-child-out-date"),editChildInHeight:$("#edit-child-in-height"),editChildOutHeight:$("#edit-child-out-height"),editChildInQuality:$("#edit-child-in-quality"),editChildOutQuality:$("#edit-child-out-quality"),editChildRoom:$("#edit-child-room"),editChildProduction:$("#edit-child-production"),editChildDefects:$("#edit-child-defects"),editChildComments:$("#edit-child-comments"),delChildModal:$("#delete-child-modal"),delChildForm:$("#delete-child-form"),delChildUuid:$("#delete-child-uuid"),plantStatsForm:$("#stat-form"),plantStatsDatePeriod:$("#plant-stats-date-reporting"),plantStatsDateFrom:$("#plant-stats-date-from"),plantStatsDateTo:$("#plant-stats-date-to")},app.l("Selectors set");var NeDB=require("nedb"),uuid=require("node-uuid");app.db={options:new NeDB({filename:"./datastores/options.db",autoload:!0}),genetics:new NeDB({filename:"./datastores/genetics.db",autoload:!0}),plants:new NeDB({filename:"./datastores/plants.db",autoload:!0})},app.l("NeDB datastores initialized","DB"),app.db.resetAllDatastores=function(){"dev"===app.config.env&&(app.db.options.remove({},{multi:!0},function(t,e){app.l(e+" options removed")}),app.db.genetics.remove({},{multi:!0},function(t,e){app.l(e+" genetics removed")}),app.db.plants.remove({},{multi:!0},function(t,e){app.l(e+" plants removed")}))},app.db.countDocs=function(t){return new Promise(function(e,a){app.db[t].count({},function(n,i){n?a(Error("Unable to count docs from "+t+", with error: "+n)):e(i)})})},app.db.getDocByPosition=function(t,e){return new Promise(function(a,n){app.db[e].find({}).skip(t).limit(1).exec(function(i,o){i?n(Error("Unable to obtain doc with position "+t+" from "+e+", with error: "+i)):a(_.first(o))})})},app.db.getRandomDoc=function(t){return new Promise(function(e,a){app.db.countDocs(t).then(function(t){return Math.floor(Math.random()*(t-2))}).then(function(e){return app.db.getDocByPosition(e,t)}).then(function(t){e(t)})["catch"](function(e){a(Error("Unable to obtain a random doc from "+t+", with error: "+e))})})},app.db.getAllDocs=function(t,e){return new Promise(function(a,n){if("string"==typeof e){var i={};i[e]=1,app.db[t].find({}).sort(i).exec(function(e,i){e?n(Error("Unable to all docs from datastore "+t+", with error: "+e)):a(i)})}else app.db[t].find({},function(e,i){e?n(Error("Unable to all docs from datastore "+t+", with error: "+e)):a(i)})})},app.db.removeDoc=function(t,e){return new Promise(function(a,n){app.db[t].remove(e,{},function(e,i){e?n(Error("Unable to remove doc in "+t+" datastore, with error: "+e)):a(i)})})},app.db.removeAllDocs=function(t){return new Promise(function(e,a){"string"==typeof t?app.db[t].remove({},{multi:!0},function(n,i){n?a(Error("Unable to delete all docs from "+t+", with error: "+n)):e(i)}):_.isArray(t)&&_.each(t,function(n){app.db[n].remove({},{multi:!0},function(n,i){n?a(Error("Unable to all docs from "+t.join(", ")+", with error: "+n)):e(i)})})})},app.db.getOneDoc=function(t,e){return new Promise(function(a,n){app.db[t].findOne(e,function(e,i){e?n(Error("Unable to find doc in "+t+", with error: "+e)):a(i)})})},app.db.insertDoc=function(t,e){return new Promise(function(a,n){app.db[t].insert(e,function(t,e){t?n(Error("Unable to add plant to plants datastore, with error: "+t)):a(e)})})},app.db.insertDocIfDoesNotExist=function(t,e){return new Promise(function(a,n){app.db[t].insert(e,function(e,i){e?"uniqueViolated"===e.errorType?a():n(Error("Unable to add new doc to "+t+" datastore, with error: "+e)):a(i)})})},app.db.updateDoc=function(t,e,a){return new Promise(function(n,i){app.db[t].update(e,{$set:a},function(e,a){e?i(Error("Unable to update doc in "+t+" datastore, with error: "+e)):n(a)})})},app.db.seeders={},app.db.seeders.genetics=function(){return new Promise(function(t,e){app.l("Seeding genetics...","DB");var a=require("faker"),n=0;_.times(app.c.seeders.genetics,function(){app.db.genetics.insert({name:a.lorem.word(),insertDate:new Date,lastModDate:new Date},function(a){a&&"uniqueViolated"!==a.errorType&&e(Error("Unable to seed genetics datastore, with error: "+a)),n++,n>=app.c.seeders.genetics&&t()})})})},app.db.seeders.plants=function(){return new Promise(function(t,e){app.l("Seeding plants...","DB");var a=require("faker"),n=0;_.times(app.c.seeders.plants,function(){app.db.getRandomDoc("genetics").then(function(i){app.db.plants.insert({name:a.commerce.productName(),number:Math.floor(99*Math.random())+1,genetic:i.name,origin:a.address.country(),insertDate:new Date,lastModDate:new Date},function(a){a&&e(Error("Unable to seed plants datastore, with error: "+a)),n++,n>=app.c.seeders.plants&&t()})})})})},app.db.seeders.children=function(){return new Promise(function(t,e){app.l("Seeding children...","DB");var a=require("faker"),n=0;app.db.getAllDocs("plants").then(function(i){_.each(i,function(i){_.times(app.c.seeders.childrenPerPlant,function(){var o,d,l,r,p=app.c.seeders.childIsOutProbability;o=d=l=r=null,Math.random()<p&&(o=a.date.recent(),d=Math.floor(131*Math.random())+20,l=Math.floor(11*Math.random()),r=Math.floor(50*Math.random())+1),app.db.plants.update(i,{$push:{children:{uuid:uuid.v4(),inDate:a.date.past(),outDate:o,inHeight:Math.floor(19*Math.random())+1,outHeight:d,inQuality:Math.floor(11*Math.random()),outQuality:l,room:a.commerce.color(),production:r,defects:a.lorem.sentence(),comments:a.lorem.paragraph(),insertDate:new Date,lastModDate:new Date}}},{},function(a){a&&e(Error("Unable to seed the children of plant "+i.name+", with error: "+a)),n++,n>=app.c.seeders.childrenPerPlant*app.c.seeders.plants&&t()})})})})})},app.db.runSeeder=function(){return app.db.seeders.genetics().then(app.db.seeders.plants).then(app.db.seeders.children)},app.db.plantsRepo={insertChild:function(t,e){return new Promise(function(a,n){app.db.plants.update({_id:t},{$push:{children:e}},{},function(t,e){t?n(Error("Unable to add child to plants datastore, with error: "+t)):a(e)})})},updateChild:function(t,e){return new Promise(function(a,n){app.db.plants.update({_id:t},{$pull:{children:{uuid:e.uuid}}},{},function(i){i?n(Error("Unable to add child to plants datastore, with error: "+i)):app.db.plants.update({_id:t},{$push:{children:e}},{},function(t,e){t?n(Error("Unable to add child to plants datastore, with error: "+t)):a(e)})})})},deleteChild:function(t,e){return new Promise(function(a,n){app.db.plants.update({_id:t},{$pull:{children:{uuid:e}}},{},function(t){t?n(Error("Unable to delete child to plants datastore, with error: "+t)):a(e)})})},getChild:function(t,e){return new Promise(function(a,n){app.db.plants.findOne({_id:t},{},function(t,i){if(t)n(Error("Unable to find child of plant, with error: "+t));else{for(var o,d=0;d<i.children.length;d++)if(i.children[d].uuid===e){o=i.children[d];break}a(o)}})})},getChildren:function(t){return new Promise(function(e,a){app.db.plants.findOne({_id:t},{children:1},function(t,n){t?a(Error("Unable to find children of plant, with error: "+t)):e(n.children)})})}},app.view=app.v={},app.v.switchView=function(t,e){t.attr("id").startsWith("content-")&&(t.is(":visible")?(app.s.content.children()[app.c.outAnimation](300),setTimeout(function(){e(),t[app.c.inAnimation](300)},300)):t.is(":hidden")&&(app.s.content.children()[app.c.outAnimation](300),setTimeout(function(){e(),t[app.c.inAnimation](300)},300)))},app.v.populatePlantView=function(t){app.db.getOneDoc("plants",{_id:t}).then(function(t){app.s.contentPlant.attr("data-plant-id",t._id),app.s.contentPlantTitleName.text(t.name),app.s.contentPlantTitleGenetics.text(t.genetic),app.s.contentPlantTitleOrigin.text(t.origin);var e=[];_.each(t.children,function(t){e.push({UUID:t.uuid,"Fecha entrada":t.inDate,"Fecha salida":t.outDate,"Altura entrada":t.inHeight,"Altura salida":t.outHeight,"Calidad entrada":t.inQuality,"Calidad salida":t.outQuality,Sala:t.room,"Producción":t.production,Defectos:t.defects,Comentarios:t.comments})}),app.s.plantChildrenDatatable.clear().rows.add(e).draw("full-reset")})["catch"](function(t){})},app.v.addNewPlantToLeftMenu=function(t){var e=t._id,a=t.name;app.s.leftMenuItemsList.append('<li class="" data-plant-id="'+e+'"><a href="javascript:" class="btn-load-plant-view"><span>'+a+'</span><i class="btn-open-delete-plant-modal fa fa-times-circle"></i><i class="btn-open-edit-plant-modal fa fa-pencil"></i></a></li>')},app.v.removePlantFromLeftMenu=function(t){app.s.leftMenuItemsList.find('li[data-plant-id="'+t+'"]').remove()},app.v.updatePlantName=function(t,e){app.s.leftMenuItemsList.find('li[data-plant-id="'+t+'"] > a > span').text(e)},app.v.toggleActiveItem=function(t){app.s.leftMenuItemsList.find("li.active").removeClass("active"),$(t).addClass("active")},app.v.populateLeftMenu=function(){return app.db.getAllDocs("plants","insertDate").then(function(t){_.each(t,function(t){app.v.addNewPlantToLeftMenu(t)})})},app.v.populateGenetics=function(){return app.db.getAllDocs("genetics","insertDate").then(function(t){var e=[];_.each(t,function(t){"string"==typeof t.name&&e.push(t.name)});var a={data:e,list:{match:{enabled:!0},sort:{enabled:!0}},theme:"bootstrap"};app.s.addPlantGenetics.easyAutocomplete(a),app.s.editPlantGenetics.easyAutocomplete(a)})},app.s.leftMenu.on("click","#btn-open-add-plant-modal",function(){app.s.addPlantModal.modal("show")}),app.s.leftMenu.on("click",".btn-open-edit-plant-modal",function(t){t.stopPropagation();var e=$(this).closest("li").data("plantId");app.db.getOneDoc("plants",{_id:e}).then(function(t){app.s.editPlantTitle.text(t.name),app.s.editPlantId.val(t._id),app.s.editPlantName.val(t.name),app.s.editPlantNumber.val(t.number),app.s.editPlantGenetics.val(t.genetic),app.s.editPlantOrigin.val(t.origin),app.s.editPlantModal.modal("show")})["catch"](function(t){reportError("Could not retrieve plant",t)})}),app.s.leftMenu.on("click",".btn-open-delete-plant-modal",function(t){t.stopPropagation();var e=$(this).closest("li").data("plantId");app.s.delPlantId.val(e),app.s.delPlantModal.modal("show")}),app.s.leftMenu.on("click",".btn-load-plant-view",function(){var t=$(this);app.v.switchView(app.s.contentPlant,function(){var e=t.closest("li").data("plantId");app.v.populatePlantView(e),app.v.toggleActiveItem(t.closest("li")),reportSuccess("Loaded plant",e)})}),app.s.addPlantModal.on("click",'button[type="submit"]',function(){var t=app.s.addPlantForm.serializeObject();disableForm(app.s.addPlantForm);var e={name:t.addPlantName,number:t.addPlantNumber,genetic:t.addPlantGenetics,origin:t.addPlantOrigin,insertDate:new Date,lastModDate:new Date},a={name:t.addPlantGenetics,insertDate:new Date,lastModDate:new Date};app.db.insertDoc("plants",e).then(function(t){reportSuccess("Added new plant",t),app.v.addNewPlantToLeftMenu(t),resetModals(),app.db.insertDocIfDoesNotExist("genetics",a).then(function(t){app.v.populateGenetics(t)})})["catch"](function(t){reportError("Could not add plant",t)})}),app.s.editPlantModal.on("click",'button[type="submit"]',function(){var t=app.s.editPlantForm.serializeObject();disableForm(app.s.editPlantForm);var e={_id:t.editPlantId},a={name:t.editPlantName,number:t.editPlantNumber,genetic:t.editPlantGenetics,origin:t.editPlantOrigin,lastModDate:new Date},n={name:t.editPlantGenetics,lastModDate:new Date};app.db.updateDoc("plants",e,a).then(function(t){1===t&&app.v.updatePlantName(e._id,a.name),reportSuccess("Edited plant",a),resetModals(),app.db.insertDocIfDoesNotExist("genetics",n).then(function(t){app.v.populateGenetics(t)})})["catch"](function(t){reportError("Could not edit plant",t)})}),app.s.delPlantModal.on("click",'button[type="submit"]',function(){var t=app.s.delPlantForm.serializeObject();disableForm(app.s.delPlantForm);var e={_id:t.deletePlantId};app.db.removeDoc("plants",e).then(function(e){1===e&&app.v.removePlantFromLeftMenu(t.deletePlantId),reportSuccess("Deleted plant",t.deletePlantId),resetModals()})["catch"](function(t){reportError("Could not delete plant",t)})}),app.s.plantChildrenTable.on("click","btn-details-child",function(){var t=$(this).closest("tr"),e=table.row(t);e.child.isShown()?(e.child.hide(),t.removeClass("shown")):(e.child(format(e.data())).show(),t.addClass("shown"))}),app.s.plantChildrenTable.find("thead th input").click(function(t){return t&&t.preventDefault(),!1}),app.s.plantChildrenTableInDateFilter.change(function(t){var e=$(t.target).parent().index();app.s.plantChildrenDatatable.column(e).search($(this).val()).draw()}),app.s.plantChildrenTableOutDateFilter.change(function(t){var e=$(t.target).parent().index();app.s.plantChildrenDatatable.column(e).search($(this).val()).draw()}),app.s.plantChildrenTable.find("thead th input").keydown(function(t){if(13==t.keyCode){var e=$(t.target).parent().index();return app.s.plantChildrenDatatable.column(e).search($(this).val()).draw(),event&&event.preventDefault(),!1}}),app.s.content.on("click",".btn-open-add-child-modal",function(){app.s.addChildModal.modal("show")}),app.s.content.on("click",".btn-open-edit-child-modal",function(t){var e=app.s.contentPlant.attr("data-plant-id"),a=$(this).attr("child-uuid");app.db.plantsRepo.getChild(e,a).then(function(t){app.s.editChildTitle.text(t.name),app.s.editChildUuid.val(t.uuid),app.s.editChildInDate.datepicker("update",new Date(t.inDate)),app.s.editChildOutDate.datepicker("update",void 0!=t.outDate?new Date(t.outDate):null),app.s.editChildInHeight.val(t.inHeight),app.s.editChildOutHeight.val(t.outHeight),app.s.editChildInQuality.val(t.inQuality),app.s.editChildOutQuality.val(t.outQuality),app.s.editChildRoom.val(t.room),app.s.editChildProduction.val(t.production),app.s.editChildDefects.val(t.defects),app.s.editChildComments.val(t.comments),app.s.editChildModal.modal("show")})["catch"](function(t){reportError("Could not retrieve plant child",t)})}),app.s.content.on("click",".btn-open-delete-child-modal",function(t){app.s.delChildUuid.val($(this).attr("child-uuid")),app.s.delChildModal.modal("show")}),app.s.addChildForm.on("submit",function(){var t=app.s.addChildForm.serializeObject();disableForm(app.s.addChildForm);var e=app.s.contentPlant.attr("data-plant-id"),a={uuid:uuid(),inDate:app.s.addChildInDate.datepicker("getDate"),outDate:app.s.addChildOutDate.datepicker("getDate"),inHeight:t.addChildInHeight,outHeight:t.addChildOutHeight,inQuality:t.addChildInQuality,outQuality:t.addChildOutQuality,room:t.addChildRoom,production:t.addChildProduction,defects:t.addChildDefects,comments:t.addChildComments,insertDate:new Date,lastModDate:new Date};return app.db.plantsRepo.insertChild(e,a).then(function(t){app.v.populatePlantView(e),reportSuccess("Added plant child",t),resetModals()})["catch"](function(t){reportError("Could not add plant child",t)}),!1}),app.s.editChildForm.on("submit",function(){var t=app.s.editChildForm.serializeObject();disableForm(app.s.editChildForm);var e=app.s.contentPlant.attr("data-plant-id"),a={uuid:t.editChildUuid,inDate:app.s.editChildInDate.datepicker("getDate"),outDate:app.s.editChildOutDate.datepicker("getDate"),inHeight:t.editChildInHeight,outHeight:t.editChildOutHeight,inQuality:t.editChildInQuality,outQuality:t.editChildOutQuality,room:t.editChildRoom,production:t.editChildProduction,defects:t.editChildDefects,comments:t.editChildComments,insertDate:t.editChildInsertDate,lastModDate:new Date};return app.db.plantsRepo.updateChild(e,a).then(function(t){app.v.populatePlantView(e),reportSuccess("Edited plant child",t),resetModals()})["catch"](function(t){reportError("Could not edit plant child",t)}),!1}),app.s.delChildForm.on("submit",function(){var t=app.s.delChildForm.serializeObject();disableForm(app.s.delChildForm);var e=app.s.contentPlant.attr("data-plant-id"),a=t.deleteChildUuid;return app.db.plantsRepo.deleteChild(e,a).then(function(){app.v.populatePlantView(e),reportSuccess("Deleted plant child",{plantId:e,childId:a}),resetModals()})["catch"](function(t){reportError("Could not delete plant child",t)}),!1});var reportEntryFactory={"total-children-production":{getDateDimension:function(t){return t.outDate},getData:function(t){return parseInt(t.production)},reduce:function(t){return void 0===t["total-children-production"]?0:t["total-children-production"]}},"avg-children-production":{getDateDimension:function(t){return t.outDate},getData:function(t){return parseInt(t.production)},reduce:function(t){return void 0===t["avg-children-production"]?0:0===t["avg-children-production-count"]?0:t["avg-children-production"]/t["avg-children-production-count"]}},"avg-in-quality":{getDateDimension:function(t){return t.inDate},getData:function(t){return parseInt(t.inQuality)},reduce:function(t){return void 0===t["avg-in-quality"]?0:0===t["avg-in-quality-count"]?0:t["avg-in-quality"]/t["avg-in-quality-count"]}},"avg-out-quality":{getDateDimension:function(t){return t.outDate},getData:function(t){return parseInt(t.outQuality)},reduce:function(t){return void 0===t["avg-out-quality"]?0:0===t["avg-out-quality-count"]?0:t["avg-out-quality"]/t["avg-out-quality-count"]}},"avg-in-height":{getDateDimension:function(t){return t.inDate},getData:function(t){return parseInt(t.inHeight)},reduce:function(t){return void 0===t["avg-in-height"]?0:0===t["avg-in-height-count"]?0:t["avg-in-height"]/t["avg-in-height-count"]}},"avg-out-height":{getDateDimension:function(t){return t.outDate},getData:function(t){return parseInt(t.outHeight)},reduce:function(t){return void 0===t["avg-out-height"]?0:0===t["avg-out-height-count"]?0:t["avg-out-height"]/t["avg-out-height-count"]}}},dateFormatAssociations={D:{parseFormat:"DD/MM/YYYY",displayFormat:"dd/mm/yyyy",addition:"days",viewChange:0},M:{parseFormat:"MM/YYYY",displayFormat:"mm/yyyy",addition:"months",viewChange:1},Y:{parseFormat:"YYYY",displayFormat:"yyyy",addition:"years",viewChange:2}};app.s.plantStatsDatePeriod.find("select").on("change",function(t){var e=$(this).val(),a=dateFormatAssociations[e];app.s.plantStatsDateFrom.datepicker("remove"),app.s.plantStatsDateFrom.datepicker({format:a.displayFormat,startView:a.viewChange,minViewMode:a.viewChange}),app.s.plantStatsDateFrom.datepicker("update",moment(new Date).subtract(7,a.addition).format(a.parseFormat)),app.s.plantStatsDateTo.datepicker("remove"),app.s.plantStatsDateTo.datepicker({format:a.displayFormat,startView:a.viewChange,minViewMode:a.viewChange}),app.s.plantStatsDateTo.datepicker("update",moment(new Date).format(a.parseFormat))}),app.s.plantStatsForm.on("submit",function(){var t=app.s.plantStatsForm.serializeObject();disableForm(app.s.plantStatsForm);var e=app.s.contentPlant.attr("data-plant-id"),a=t.plantStatsDateReporting,n=dateFormatAssociations[a],i=moment(t.plantStatsDateFrom,n.parseFormat),o=moment(t.plantStatsDateTo,n.parseFormat),d=t.plantStatsLines;return void 0===d||Array.isArray(d)||(d=[d]),Array.isArray(d)&&0!==d.length?(app.db.plantsRepo.getChildren(e).then(function(t){for(var e=[],a=i;a<=o;a.add(1,n.addition)){for(var l={date:a.format(n.parseFormat)},r=0;r<d.length;r++){var p=d[r];l[p]=0,l[p+"-count"]=0}e.push(l)}for(var s=0;s<t.length;s++)for(var c=t[s],r=0;r<d.length;r++){var p=d[r],u=reportEntryFactory[p],h=u.getDateDimension(c),m=void 0;if(void 0!=h){var f=moment(h).format(n.parseFormat);m=_.find(e,function(t){return t.date===f})}if(void 0!=m){var b=u.getData(c);isNaN(b)||(m[p]+=b,m[p+"-count"]+=1)}}for(var D=[],v=0;v<e.length;v++)D.push(e[v].date);for(var g=[],r=0;r<d.length;r++){for(var p=d[r],u=reportEntryFactory[p],C=[],v=0;v<e.length;v++)C.push(u.reduce(e[v]));g.push({data:C,label:p,borderColor:randomColor()})}var w=document.getElementById("curve_chart"),P=w.getContext("2d");P.clearRect(0,0,w.width,w.height);new Chart(w,{type:"line",data:{labels:D,datasets:g}});reportSuccess("Generated report",b),enableForm(app.s.plantStatsForm)})["catch"](function(t){reportError("Could not retrieve plant children",t)}),!1):(reportError("Could not generate report - no checkbox selected"),enableForm(app.s.plantStatsForm),!1)}),app.l("Event handlers set"),$.fn.serializeObject=function(){var t={},e=this.serializeArray();return $.each(e,function(){void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t},moment.locale("es"),app.s.plantChildrenDatatable=app.s.plantChildrenTable.DataTable({autoFill:!0,colReorder:!0,responsive:{details:{type:"column"}},columnDefs:[{render:function(t,e,a){return null!==t?moment(t).format("DD/MM/YYYY"):""},targets:[2,3]},{render:function(t,e,a){return"<span class='uuid'>"+t+"</span>"},visible:function(){return"dev"!==app.config.env},searchable:!1,targets:[1]},{render:function(t,e,a){return'<span class="fa-stack btn-open-edit-child-modal" child-uuid="'+t+'"><i class="fa fa-square fa-stack-2x"></i><i class="fa fa-pencil fa-stack-1x fa-inverse"></i></span>'},searchable:!1,targets:[12]},{render:function(t,e,a){return'<span class="fa-stack btn-open-delete-child-modal" child-uuid="'+t+'"><i class="fa fa-square fa-stack-2x"></i><i class="fa fa-times fa-stack-1x fa-inverse"></i></span>'},searchable:!1,targets:[13]}],columns:[{className:"control",orderable:!1,data:null,defaultContent:'<span class="fa-stack btn-details-child"><i class="fa fa-square fa-stack-2x"></i><i class="fa fa-info fa-stack-1x fa-inverse"></i></span>'},{data:"UUID"},{data:"Fecha entrada"},{data:"Fecha salida"},{data:"Altura entrada"},{data:"Altura salida"},{data:"Calidad entrada"},{data:"Calidad salida"},{data:"Sala"},{data:"Producción"},{data:"Defectos",orderable:!1,searchable:!1,className:"none"},{data:"Comentarios",orderable:!1,searchable:!1,className:"none"},{data:"UUID",orderable:!1,searchable:!1,defaultContent:"error"},{data:"UUID",orderable:!1,searchable:!1,defaultContent:"error"}],order:[[2,"desc"]]}),app.l("Datatables initialized");var datepickerOptions={language:"es",endDate:"0d",autoclose:!0,clearBtn:!0};$.fn.datepicker.dates.es={days:moment.weekdays(),daysShort:moment.weekdaysShort(),daysMin:moment.weekdaysMin(),months:moment.months(),monthsShort:moment.monthsShort(),today:"Today",clear:"Cancelar",format:"dd/mm/yyyy",weekStart:moment.localeData().firstDayOfWeek(),showOnFocus:!1},app.s.addChildInDate.datepicker(datepickerOptions),app.s.addChildOutDate.datepicker(datepickerOptions),app.s.editChildInDate.datepicker(datepickerOptions),app.s.editChildOutDate.datepicker(datepickerOptions),app.s.plantStatsDateFrom.datepicker(datepickerOptions),app.s.plantStatsDateFrom.datepicker("setDate",moment(new Date).subtract(7,"days").format("DD/MM/YYYY")),app.s.plantStatsDateTo.datepicker(datepickerOptions),app.s.plantStatsDateTo.datepicker("setDate",moment(new Date).format("DD/MM/YYYY")),app.s.plantChildrenTableInDateFilter.datepicker(datepickerOptions),app.s.plantChildrenTableOutDateFilter.datepicker(datepickerOptions),app.l("Datepickers initialized"),app.db.options.count({},function(t,e){0===e?(app.l("Initializing datastores for the first time","DB"),app.db.options.insert({name:"firstRun",value:!1,insertDate:new Date},function(t){t&&app.l("Unable to insert firstRun doc in options datastore with error: "+t,"DB")}),app.l("Adding indexes to datastores","DB"),app.db.genetics.ensureIndex({fieldName:"name",unique:!0},function(t){t&&app.l("Unable to set name fields as an index with unique constraint, with error: "+t,"DB")}),"dev"!==app.c.env&&"development"!==app.c.env||app.db.runSeeder().then(function(){app.l("Datastores seeded without errors","DB")})["catch"](function(t){app.l("Unable to seed datastores, with error: "+t)}).then(app.v.populateLeftMenu).then(app.v.populateGenetics).then(function(){app.l("Views populated with datastores data")})["catch"](function(t){app.l("Unable to populate views with datastore data, with error: "+t)})):app.v.populateLeftMenu().then(app.v.populateGenetics).then(function(){app.l("Views populated with datastores data")})["catch"](function(t){app.l("Unable to populate views with datastore data, with error: "+t)})}),$(function(){}),app.l("App initialized","DB");